# Autonotes Backend

[![Java CI with Gradle](https://github.com/IWKMS99/AutonotesBackend/actions/workflows/gradle.yml/badge.svg)](https://github.com/IWKMS99/AutonotesBackend/actions/workflows/gradle.yml)

–ë—ç–∫–µ–Ω–¥-—Å–µ—Ä–≤–∏—Å –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã "Autonotes". –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞–º–∏ –∏ –Ω–∞–¥–µ–∂–Ω—É—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å ML-—Å–µ—Ä–≤–∏—Å–æ–º.

## üöÄ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

*   **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
    *   JWT Access Token (Stateless).
    *   –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ UserDetails –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –ë–î.
    *   **Rate Limiting** (Resilience4j) –Ω–∞ —ç–Ω–¥–ø–æ–∏–Ω—Ç–µ –≤—Ö–æ–¥–∞.
    *   –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤ —á–µ—Ä–µ–∑ **Apache Tika** (–ø—Ä–æ–≤–µ—Ä–∫–∞ magic bytes).

*   **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö (Architecture Patterns):**
    *   **Transactional Outbox**: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏ –≤ –ë–î –∏ —Å–æ–±—ã—Ç–∏—è –≤ `outbox_events` –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏. –°–æ–±—ã—Ç–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ RabbitMQ –æ—Ç–¥–µ–ª—å–Ω—ã–º —Ñ–æ–Ω–æ–≤—ã–º –ø—Ä–æ—Ü–µ—Å—Å–æ–º, —á—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –¥–∞–∂–µ –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ –±—Ä–æ–∫–µ—Ä–∞.
    *   **At-Least-Once Delivery**: –ì–∞—Ä–∞–Ω—Ç–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è ML-–æ–±—Ä–∞–±–æ—Ç–∫–∏.

*   **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º (S3/MinIO):**
    *   –ó–∞–≥—Ä—É–∑–∫–∞ –∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.
    *   **Compensating Transactions**: –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ –ø—Ä–∏ –æ—à–∏–±–∫–µ –∑–∞–ø–∏—Å–∏ –≤ –ë–î.
    *   **Garbage Collector**: –§–æ–Ω–æ–≤–∞—è –æ—á–∏—Å—Ç–∫–∞ "—Ñ–∞–π–ª–æ–≤-—Å–∏—Ä–æ—Ç" (—Ñ–∞–π–ª–æ–≤ –≤ S3, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ—Ç —Å—Å—ã–ª–æ–∫ –≤ –ë–î), –≤–æ–∑–Ω–∏–∫–∞—é—â–∏—Ö –ø—Ä–∏ —Å–±–æ—è—Ö.

*   **Observability:**
    *   –°–∫–≤–æ–∑–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å `RequestId` (MDC).
    *   –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ —á–µ—Ä–µ–∑ AOP.

## üõ†Ô∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

*   **Java:** 24 (—Å –≤–∫–ª—é—á–µ–Ω–Ω—ã–º–∏ Virtual Threads)
*   **Framework:** Spring Boot 3.5.7
*   **Database:** PostgreSQL 16 + Flyway Migration
*   **Storage:** MinIO (AWS S3 SDK v2)
*   **Messaging:** RabbitMQ
*   **Testing:** Testcontainers (Postgres, MinIO, RabbitMQ), ArchUnit

## ‚öôÔ∏è –ó–∞–ø—É—Å–∫ –ª–æ–∫–∞–ª—å–Ω–æ

1.  **–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
    –í –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
    ```bash
    docker-compose up -d db minio rabbitmq
    ```
2.  **–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:**
    ```bash
    ./gradlew bootRun
    ```

## üîë –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è)

–û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã `application.properties`:

### –û—Å–Ω–æ–≤–Ω—ã–µ
| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|:---|:---|:---|
| `SERVER_PORT` | –ü–æ—Ä—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. | `8080` |
| `JWT_SECRET` | **(–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)** Base64 –∫–ª—é—á –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ —Ç–æ–∫–µ–Ω–æ–≤. | *–ù–µ—Ç* |
| `JWT_EXPIRATION_MS` | –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ —Ç–æ–∫–µ–Ω–∞ (–º—Å). | `86400000` |

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|:---|:---|:---|
| `SPRING_DATASOURCE_URL` | JDBC URL. | `jdbc:postgresql://localhost:5432/autonotes` |
| `SPRING_DATASOURCE_USERNAME` | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ë–î. | `myuser` |
| `SPRING_DATASOURCE_PASSWORD` | –ü–∞—Ä–æ–ª—å –ë–î. | `mypassword` |
| `SPRING_JPA_HIBERNATE_DDL_AUTO` | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ö–µ–º–æ–π Hibernate (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è `none` –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ Flyway). | `none` |

### –§–∞–π–ª–æ–≤–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (S3)
| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|:---|:---|:---|
| `MINIO_ENDPOINT` | URL API MinIO. | *–ù–µ—Ç* |
| `MINIO_ACCESS_KEY` | Access Key. | *–ù–µ—Ç* |
| `MINIO_SECRET_KEY` | Secret Key. | *–ù–µ—Ç* |
| `aws.s3.bucket` | –ò–º—è –±–∞–∫–µ—Ç–∞. | `lecture-notes` |

### –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∏ –§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏
| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|:---|:---|:---|
| `app.scheduling.outbox-interval-ms` | –ò–Ω—Ç–µ—Ä–≤–∞–ª –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–±—ã—Ç–∏–π –∏–∑ Outbox —Ç–∞–±–ª–∏—Ü—ã –≤ RabbitMQ (–º—Å). | `2000` |
| `app.scheduling.s3-cleanup-cron` | CRON –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Å–±–æ—Ä—â–∏–∫–∞ –º—É—Å–æ—Ä–∞ S3. | `0 0 3 * * *` (3:00) |
| `app.scheduling.cleanup-retention-hours`| –í—Ä–µ–º—è –≤ —á–∞—Å–∞—Ö, –ø–æ—Å–ª–µ –∫–æ—Ç–æ—Ä–æ–≥–æ —Ñ–∞–π–ª –±–µ–∑ —Å—Å—ã–ª–∫–∏ –≤ –ë–î —Å—á–∏—Ç–∞–µ—Ç—Å—è –º—É—Å–æ—Ä–æ–º. | `24` |
| `app.notes.processing-timeout-minutes` | –¢–∞–π–º–∞—É—Ç, –ø–æ—Å–ª–µ –∫–æ—Ç–æ—Ä–æ–≥–æ —Å—Ç–∞—Ç—É—Å `PROCESSING` –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ `FAILED`. | `10` |

### –ë—Ä–æ–∫–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π (RabbitMQ)
| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|:---|:---|:---|
| `SPRING_RABBITMQ_HOST` | –•–æ—Å—Ç RabbitMQ. | `localhost` |
| `SPRING_RABBITMQ_PORT` | –ü–æ—Ä—Ç AMQP. | `5672` |

## üìö API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

Swagger UI –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É: **http://localhost:8080/swagger-ui.html**
